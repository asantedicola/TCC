{"ast":null,"code":"var _s = $RefreshSig$();\nimport { aggregate, createDirectus, readItems, rest } from \"@directus/sdk\";\nimport { useState } from \"react\";\nimport client from \"./api\";\nconst PAGE_SIZE = 10;\n\n// https://docs.directus.io/reference/filter-rules.html\n\nasync function fetchItemsInstituicoes(collection, filter, page) {\n  const offset = (page - 1) * PAGE_SIZE;\n  return await client.request(readItems(collection, {\n    limit: PAGE_SIZE,\n    offset,\n    filter,\n    fields: [\"*\", \"id_usuario.*\"]\n  }));\n}\nasync function countItems(collection, filter) {\n  return await client.request(aggregate(collection, {\n    aggregate: {\n      count: \"*\"\n    },\n    query: {\n      filter\n    }\n  }));\n}\nconst useApiInstituicoes = () => {\n  _s();\n  const [instituicoes, setInstituicoes] = useState([]);\n  const [instituicoesTotal, setInstituicoesTotal] = useState(0);\n  return {\n    pageSize: PAGE_SIZE,\n    getInstituicoes: async (query, page) => {\n      var _await$countItems, _await$countItems$;\n      const filter = query ? {\n        _or: [{\n          area_atuacao: {\n            _contains: query\n          }\n        }, {\n          endereco: {\n            _contains: query\n          }\n        }],\n        _and: [{\n          id_usuario: {\n            ativo: true\n          }\n        }]\n      } : {\n        _and: [{\n          id_usuario: {\n            ativo: true\n          }\n        }]\n      };\n\n      // Fetch total count\n      setInstituicoesTotal((_await$countItems = await countItems(\"Instituicao\", filter)) === null || _await$countItems === void 0 ? void 0 : (_await$countItems$ = _await$countItems[0]) === null || _await$countItems$ === void 0 ? void 0 : _await$countItems$.count);\n\n      // Fetch data including related usuario data\n      const instituicoesData = await fetchItemsInstituicoes(\"Instituicao\", filter, page);\n\n      // Set the state with fetched instituicoes data including usuario reference\n      setInstituicoes(instituicoesData);\n    },\n    instituicoes,\n    instituicoesTotal,\n    instituicoesTotalPages: Math.ceil(instituicoesTotal / PAGE_SIZE)\n  };\n};\n_s(useApiInstituicoes, \"gAJnt2ceaPFucUDumw9DrKVuRrw=\");\nexport default useApiInstituicoes;","map":{"version":3,"names":["aggregate","createDirectus","readItems","rest","useState","client","PAGE_SIZE","fetchItemsInstituicoes","collection","filter","page","offset","request","limit","fields","countItems","count","query","useApiInstituicoes","_s","instituicoes","setInstituicoes","instituicoesTotal","setInstituicoesTotal","pageSize","getInstituicoes","_await$countItems","_await$countItems$","_or","area_atuacao","_contains","endereco","_and","id_usuario","ativo","instituicoesData","instituicoesTotalPages","Math","ceil"],"sources":["C:/Users/Anderson/Desktop/TestesTCC/TCC/tcc-frontend/src/api/apiInstituicoes.js"],"sourcesContent":["import {aggregate, createDirectus, readItems, rest} from \"@directus/sdk\";\r\nimport {useState} from \"react\";\r\nimport client from \"./api\";\r\n\r\nconst PAGE_SIZE = 10;\r\n\r\n// https://docs.directus.io/reference/filter-rules.html\r\n\r\nasync function fetchItemsInstituicoes(collection, filter, page) {\r\n   const offset = (page - 1) * PAGE_SIZE;\r\n   return await client.request(readItems(collection, {\r\n      limit: PAGE_SIZE,\r\n      offset,\r\n      filter,\r\n      fields:[\"*\", \"id_usuario.*\"]\r\n   }));\r\n\r\n}\r\n\r\nasync function countItems(collection, filter) {\r\n   return await client.request(aggregate(collection, {\r\n      aggregate: {count: \"*\"},\r\n      query: {\r\n         filter\r\n      }\r\n   }));\r\n\r\n}\r\n\r\nconst useApiInstituicoes = () => {\r\n   const [instituicoes, setInstituicoes] = useState([]);\r\n   const [instituicoesTotal, setInstituicoesTotal] = useState(0);\r\n\r\n   return {\r\n      pageSize: PAGE_SIZE,\r\n      getInstituicoes: async (query, page) => {\r\n         const filter = query ? {\r\n            _or: [\r\n               { area_atuacao: { _contains: query } },\r\n               { endereco: { _contains: query } }\r\n            ],\r\n            _and: [\r\n               { id_usuario: { ativo: true}}\r\n            ]\r\n         } : {_and: [\r\n            { id_usuario: { ativo: true}}\r\n         ]};\r\n\r\n         // Fetch total count\r\n         setInstituicoesTotal((await countItems(\"Instituicao\", filter))?.[0]?.count);\r\n\r\n         // Fetch data including related usuario data\r\n         const instituicoesData = await fetchItemsInstituicoes(\r\n            \"Instituicao\",\r\n            filter, \r\n            page\r\n         );\r\n\r\n         // Set the state with fetched instituicoes data including usuario reference\r\n         setInstituicoes(instituicoesData);\r\n      },\r\n      instituicoes,\r\n      instituicoesTotal,\r\n      instituicoesTotalPages: Math.ceil(instituicoesTotal / PAGE_SIZE)\r\n   }\r\n}\r\n\r\nexport default useApiInstituicoes;\r\n"],"mappings":";AAAA,SAAQA,SAAS,EAAEC,cAAc,EAAEC,SAAS,EAAEC,IAAI,QAAO,eAAe;AACxE,SAAQC,QAAQ,QAAO,OAAO;AAC9B,OAAOC,MAAM,MAAM,OAAO;AAE1B,MAAMC,SAAS,GAAG,EAAE;;AAEpB;;AAEA,eAAeC,sBAAsBA,CAACC,UAAU,EAAEC,MAAM,EAAEC,IAAI,EAAE;EAC7D,MAAMC,MAAM,GAAG,CAACD,IAAI,GAAG,CAAC,IAAIJ,SAAS;EACrC,OAAO,MAAMD,MAAM,CAACO,OAAO,CAACV,SAAS,CAACM,UAAU,EAAE;IAC/CK,KAAK,EAAEP,SAAS;IAChBK,MAAM;IACNF,MAAM;IACNK,MAAM,EAAC,CAAC,GAAG,EAAE,cAAc;EAC9B,CAAC,CAAC,CAAC;AAEN;AAEA,eAAeC,UAAUA,CAACP,UAAU,EAAEC,MAAM,EAAE;EAC3C,OAAO,MAAMJ,MAAM,CAACO,OAAO,CAACZ,SAAS,CAACQ,UAAU,EAAE;IAC/CR,SAAS,EAAE;MAACgB,KAAK,EAAE;IAAG,CAAC;IACvBC,KAAK,EAAE;MACJR;IACH;EACH,CAAC,CAAC,CAAC;AAEN;AAEA,MAAMS,kBAAkB,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC9B,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAGjB,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACkB,iBAAiB,EAAEC,oBAAoB,CAAC,GAAGnB,QAAQ,CAAC,CAAC,CAAC;EAE7D,OAAO;IACJoB,QAAQ,EAAElB,SAAS;IACnBmB,eAAe,EAAE,MAAAA,CAAOR,KAAK,EAAEP,IAAI,KAAK;MAAA,IAAAgB,iBAAA,EAAAC,kBAAA;MACrC,MAAMlB,MAAM,GAAGQ,KAAK,GAAG;QACpBW,GAAG,EAAE,CACF;UAAEC,YAAY,EAAE;YAAEC,SAAS,EAAEb;UAAM;QAAE,CAAC,EACtC;UAAEc,QAAQ,EAAE;YAAED,SAAS,EAAEb;UAAM;QAAE,CAAC,CACpC;QACDe,IAAI,EAAE,CACH;UAAEC,UAAU,EAAE;YAAEC,KAAK,EAAE;UAAI;QAAC,CAAC;MAEnC,CAAC,GAAG;QAACF,IAAI,EAAE,CACR;UAAEC,UAAU,EAAE;YAAEC,KAAK,EAAE;UAAI;QAAC,CAAC;MAC/B,CAAC;;MAEF;MACAX,oBAAoB,EAAAG,iBAAA,GAAE,MAAMX,UAAU,CAAC,aAAa,EAAEN,MAAM,CAAC,cAAAiB,iBAAA,wBAAAC,kBAAA,GAAxCD,iBAAA,CAA4C,CAAC,CAAC,cAAAC,kBAAA,uBAA9CA,kBAAA,CAAgDX,KAAK,CAAC;;MAE3E;MACA,MAAMmB,gBAAgB,GAAG,MAAM5B,sBAAsB,CAClD,aAAa,EACbE,MAAM,EACNC,IACH,CAAC;;MAED;MACAW,eAAe,CAACc,gBAAgB,CAAC;IACpC,CAAC;IACDf,YAAY;IACZE,iBAAiB;IACjBc,sBAAsB,EAAEC,IAAI,CAACC,IAAI,CAAChB,iBAAiB,GAAGhB,SAAS;EAClE,CAAC;AACJ,CAAC;AAAAa,EAAA,CApCKD,kBAAkB;AAsCxB,eAAeA,kBAAkB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}